<div
  *ngIf="spinner"
  class="d-flex justify-content-center align-items-center"
  style="min-height: 200px"
>
  <div
    class="spinner-border text-primary"
    style="width: 3rem; height: 3rem"
    role="status"
  >
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>

<div *ngIf="!spinner && mostrarTabla" class="container mt-4">
  <!-- Divider decorativo arriba del encabezado -->
  <div class="w-100 mb-4">
    <div
      class="mx-auto"
      style="
        height: 4px;
        width: 80px;
        background: linear-gradient(to right, #0d6efd, #6c757d);
        border-radius: 2px;
      "
    ></div>
  </div>

  <!-- Encabezado -->
  <div class="mb-4">
    <h4 class="fw-bold text-primary mb-2 d-flex align-items-center">
      <i class="bi bi-graph-up-arrow me-2"></i>
      Ingredientes por proveedor
    </h4>
    <p class="text-muted small mb-0">
      📌 Consulta y compara los proveedores que ofrecen un ingrediente
      especifico.
    </p>
  </div>

  <!-- Filtros -->
  <div
    class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"
  >
    <div class="d-flex align-items-center gap-2">
      <input
        type="text"
        class="form-control form-control-sm ms-2 shadow-sm"
        style="width: 400px"
        placeholder="🔍 Buscar por proveedor o ingrediente"
        [(ngModel)]="textoBusqueda"
        (input)="actualizarTabla()"
      />
    </div>
  </div>

  <!-- Tabla de historial -->
  <div class="table-responsive shadow-sm rounded-3 border">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-gradient text-center">
        <tr>
          <th scope="col" (click)="ordenarPor('ingrediente')" class="sortable">
            Ingrediente
            <i
              *ngIf="ordenColumna === 'ingrediente'"
              class="bi"
              [ngClass]="ordenAsc ? 'bi-caret-up-fill' : 'bi-caret-down-fill'"
            ></i>
          </th>
          <th scope="col" (click)="ordenarPor('precio')" class="sortable">
            Precio
            <i
              *ngIf="ordenColumna === 'precio'"
              class="bi"
              [ngClass]="ordenAsc ? 'bi-caret-up-fill' : 'bi-caret-down-fill'"
            ></i>
          </th>
          <th scope="col" (click)="ordenarPor('proveedor')" class="sortable">
            Proveedor
            <i
              *ngIf="ordenColumna === 'proveedor'"
              class="bi"
              [ngClass]="ordenAsc ? 'bi-caret-up-fill' : 'bi-caret-down-fill'"
            ></i>
          </th>
          <th scope="col" class="sortable">
            Telefono
            <i class="bi"></i>
          </th>
          <th scope="col" class="sortable">
            Direccion
            <i class="bi"></i>
          </th>
          <th scope="col" (click)="ordenarPor('calificacion')" class="sortable">
            Calificacion
            <i
              *ngIf="ordenColumna === 'calificacion'"
              class="bi"
              [ngClass]="ordenAsc ? 'bi-caret-up-fill' : 'bi-caret-down-fill'"
            ></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let h of ingredientesProveedoresPaginado"
          class="text-center"
        >
          <td class="fw-semibold text-dark">{{ h.ingrediente?.nombre }}</td>
          <td class="fw-bold text-success">
            {{ h.precio | currency : "USD" }}
          </td>
          <td class="fw-semibold text-dark">
            {{ h.proveedor?.nombre }}
          </td>

          <td class="text-muted">
            {{ h.proveedor?.telefono }}
          </td>
          <td class="text-muted">
            {{ h.proveedor?.direccion }}
          </td>
          <td class="text-center">
            <span
              class="calificacion-badge"
              [ngClass]="getColorCalificacion(h.proveedor?.calificacion)"
            >
              {{ h.proveedor?.calificacion }}
            </span>
          </td>
        </tr>
        <tr *ngIf="ingredientesProveedoresPaginado.length === 0">
          <td colspan="6" class="text-center text-muted py-3">
            🚫 No hay datos disponibles
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3 mb-5">
    <!-- Lado izquierdo: Selector de filas -->
    <div class="d-flex align-items-center gap-2">
      <label class="fw-semibold mb-0">Mostrar</label>
      <select
        class="form-select form-select-sm w-auto shadow-sm"
        [(ngModel)]="tamanoPagina"
        (change)="cambiarTamanoPagina()"
      >
        <option [value]="10">10</option>
        <option [value]="25">25</option>
        <option [value]="50">50</option>
      </select>
      <span class="fw-semibold mb-0">filas</span>
    </div>

    <!-- Lado derecho: Paginación -->
    <nav>
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="pagina === 1">
          <a class="page-link" (click)="cambiarPagina(pagina - 1)">Anterior</a>
        </li>
        <li
          class="page-item"
          *ngFor="let p of paginasTotales"
          [class.active]="pagina === p"
        >
          <a class="page-link" (click)="cambiarPagina(p)">{{ p }}</a>
        </li>
        <li
          class="page-item"
          [class.disabled]="
            pagina === paginasTotales.length || paginasTotales.length === 0
          "
        >
          <a class="page-link" (click)="cambiarPagina(pagina + 1)">Siguiente</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
