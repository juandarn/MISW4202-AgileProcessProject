<app-encabezado></app-encabezado>

<div class="container my-5">
  <!-- Alerta de error si existe -->
  <div *ngIf="errorMessage" class="alert alert-danger text-center shadow-sm">
    <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ errorMessage }}
  </div>

  <!-- Card de detalle del menú -->
  <div *ngIf="menuForm && !errorMessage" class="card shadow-sm border-light">
    <div class="card-body p-4 p-md-5">
      <div class="row g-5">
        <!-- Imagen del menú -->
        <div
          class="col-lg-5 d-flex align-items-center justify-content-center"
          *ngIf="imagenPreview"
        >
          <img
            [src]="imagenPreview"
            alt="Foto del menú"
            class="img-fluid rounded-3 shadow"
          />
        </div>
        <!-- Información principal del menú -->
        <div class="col-lg-7">
          <h2 class="card-title fw-bolder text-custom-primary mb-3">
            {{ menuForm.get("nombre")?.value }}
          </h2>
          <p class="lead text-muted mb-4">
            {{ menuForm.get("descripcion")?.value }}
          </p>
          <p class="lead text-muted mb-4">{{ menuForm.get("autor")?.value }}</p>
          <div class="d-flex flex-column flex-sm-row flex-wrap gap-4 mb-4">
            <!-- Fecha de inicio -->
            <div class="d-flex align-items-center text-muted">
              <i class="bi bi-calendar-check fs-4 me-2 text-success"></i>
              <div>
                <small class="text-uppercase fw-bold">Inicio</small>
                <div class="fs-6">
                  {{ menuForm.get("fechainicio")?.value | date : "longDate" }}
                </div>
              </div>
            </div>
            <!-- Fecha de fin -->
            <div class="d-flex align-items-center text-muted">
              <i class="bi bi-calendar-x fs-4 me-2 text-danger"></i>
              <div>
                <small class="text-uppercase fw-bold">Fin</small>
                <div class="fs-6">
                  {{ menuForm.get("fechafin")?.value | date : "longDate" }}
                </div>
              </div>
            </div>
            <!-- Autor (si existe) -->
            <div
              *ngIf="menuForm.get('autor.nombre')?.value"
              class="d-flex align-items-center text-muted"
            >
              <i class="bi bi-person-circle fs-4 me-2"></i>
              <div>
                <small class="text-uppercase fw-bold">Creado por</small>
                <div class="fs-6">
                  {{ menuForm.get("autor.nombre")?.value }}
                </div>
              </div>
            </div>
          </div>

          <!-- Botón calcular compra (justo después de la info principal) -->
          <div class="mb-4">
            <button
              class="btn text-white shadow-sm d-flex align-items-center gap-2 bg-custom-primary"
              (click)="calcularCompraMenu()"
            >
              <i class="bi bi-cart-check-fill fs-5"></i>
              Calcular Compra
            </button>
          </div>
        </div>
      </div>

      <hr class="my-4 my-md-5" />

      <!-- Tabla de recetas asociadas -->
      <div>
        <h3 class="fw-bold mb-4">
          <i class="bi bi-journal-bookmark-fill me-2 text-custom-primary"></i>
          Recetas Incluidas
        </h3>
        <div *ngIf="recetasParaTabla.length > 0; else noRecetas">
          <tabla-app
            [datos]="recetasParaTabla"
            [columnas]="columnasRecetas"
            (accion)="manejarAccionReceta($event)"
          >
          </tabla-app>
        </div>
        <ng-template #noRecetas>
          <div
            class="text-center p-4 rounded-3"
            style="background-color: #f8f9fa"
          >
            <p class="text-muted m-0">
              <i class="bi bi-info-circle me-2"></i>No hay recetas asociadas a
              este menú.
            </p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
